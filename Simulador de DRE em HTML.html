<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de DRE</title>
  <!-- Importando Tailwind via CDN para estilização -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Importando Chart.js para os gráficos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f5f7fa;
    }
    .card {
      background-color: white;
      border-radius: 0.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      overflow: hidden;
    }
    .card-header {
      padding: 1rem;
      border-bottom: 1px solid #e5e7eb;
    }
    .card-body {
      padding: 1.5rem;
    }
    .form-group {
      margin-bottom: 1rem;
    }
    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: #374151;
    }
    .form-control {
      width: 100%;
      padding: 0.5rem;
      border: 1px solid #d1d5db;
      border-radius: 0.375rem;
      background-color: #f9fafb;
    }
    .form-control:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.25);
    }
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    .table th, .table td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #e5e7eb;
    }
    .table th {
      background-color: #f9fafb;
      font-weight: 600;
    }
    .text-right {
      text-align: right;
    }
    .text-center {
      text-align: center;
    }
    .bg-highlight {
      background-color: #f0f9ff;
    }
    .bg-result {
      background-color: #ecfdf5;
    }
    .font-bold {
      font-weight: 700;
    }
    .text-indented {
      padding-left: 1.5rem;
      color: #6b7280;
    }
    .separator {
      height: 1px;
      background-color: #e5e7eb;
      margin: 1rem 0;
    }
    .chart-container {
      position: relative;
      height: 300px;
      width: 100%;
    }
  </style>
</head>
<body class="p-4">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-center text-blue-800 mb-6">Simulador de DRE</h1>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Painel de entradas -->
      <div class="card">
        <div class="card-header bg-blue-50">
          <h2 class="text-xl text-blue-700">Dados de Entrada</h2>
          <p class="text-sm text-gray-600">Insira os valores para simular o DRE</p>
        </div>
        <div class="card-body">
          <div class="form-group">
            <label for="receitaBruta" class="form-label">Receita Bruta</label>
            <input type="number" id="receitaBruta" class="form-control" value="100000">
          </div>
          
          <div class="form-group">
            <label for="deducoes" class="form-label">Deduções (Impostos, Devoluções)</label>
            <input type="number" id="deducoes" class="form-control" value="10000">
          </div>
          
          <div class="form-group">
            <label for="cpv" class="form-label">Custo dos Produtos Vendidos</label>
            <input type="number" id="cpv" class="form-control" value="40000">
          </div>
          
          <div class="separator"></div>
          
          <div class="form-group">
            <label for="despesasAdministrativas" class="form-label">Despesas Administrativas</label>
            <input type="number" id="despesasAdministrativas" class="form-control" value="15000">
          </div>
          
          <div class="form-group">
            <label for="despesasVendas" class="form-label">Despesas com Vendas</label>
            <input type="number" id="despesasVendas" class="form-control" value="8000">
          </div>
          
          <div class="separator"></div>
          
          <div class="form-group">
            <label for="despesasFinanceiras" class="form-label">Despesas Financeiras</label>
            <input type="number" id="despesasFinanceiras" class="form-control" value="2000">
          </div>
          
          <div class="form-group">
            <label for="receitasFinanceiras" class="form-label">Receitas Financeiras</label>
            <input type="number" id="receitasFinanceiras" class="form-control" value="500">
          </div>
          
          <div class="separator"></div>
          
          <div class="form-group">
            <label for="irCsllRate" class="form-label">Alíquota IR/CSLL (%)</label>
            <input type="number" id="irCsllRate" class="form-control" value="34">
          </div>
        </div>
      </div>
      
      <!-- Demonstrativo de Resultado -->
      <div class="card col-span-1 lg:col-span-2">
        <div class="card-header bg-green-50">
          <h2 class="text-xl text-green-700">Demonstrativo de Resultado do Exercício</h2>
          <p class="text-sm text-gray-600">Período: Simulação</p>
        </div>
        <div class="card-body">
          <div class="overflow-x-auto">
            <table class="table">
              <thead>
                <tr>
                  <th class="w-2/3">Descrição</th>
                  <th class="text-right">Valor</th>
                  <th class="text-right">% Receita Bruta</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="font-bold">Receita Bruta</td>
                  <td class="text-right" id="valor-receita-bruta">R$ 100.000,00</td>
                  <td class="text-right">100%</td>
                </tr>
                <tr>
                  <td class="text-indented">(-) Deduções</td>
                  <td class="text-right text-gray-600" id="valor-deducoes">(R$ 10.000,00)</td>
                  <td class="text-right text-gray-600" id="perc-deducoes">10.0%</td>
                </tr>
                <tr class="bg-highlight">
                  <td class="font-bold">Receita Líquida</td>
                  <td class="text-right font-bold" id="valor-receita-liquida">R$ 90.000,00</td>
                  <td class="text-right" id="perc-receita-liquida">90.0%</td>
                </tr>
                <tr>
                  <td class="text-indented">(-) Custo dos Produtos Vendidos</td>
                  <td class="text-right text-gray-600" id="valor-cpv">(R$ 40.000,00)</td>
                  <td class="text-right text-gray-600" id="perc-cpv">40.0%</td>
                </tr>
                <tr class="bg-highlight">
                  <td class="font-bold">Lucro Bruto</td>
                  <td class="text-right font-bold" id="valor-lucro-bruto">R$ 50.000,00</td>
                  <td class="text-right" id="perc-lucro-bruto">50.0%</td>
                </tr>
                <tr>
                  <td class="text-indented">(-) Despesas Administrativas</td>
                  <td class="text-right text-gray-600" id="valor-desp-adm">(R$ 15.000,00)</td>
                  <td class="text-right text-gray-600" id="perc-desp-adm">15.0%</td>
                </tr>
                <tr>
                  <td class="text-indented">(-) Despesas com Vendas</td>
                  <td class="text-right text-gray-600" id="valor-desp-vendas">(R$ 8.000,00)</td>
                  <td class="text-right text-gray-600" id="perc-desp-vendas">8.0%</td>
                </tr>
                <tr class="bg-highlight">
                  <td class="font-bold">Resultado Operacional</td>
                  <td class="text-right font-bold" id="valor-resultado-operacional">R$ 27.000,00</td>
                  <td class="text-right" id="perc-resultado-operacional">27.0%</td>
                </tr>
                <tr>
                  <td class="text-indented">(+) Receitas Financeiras</td>
                  <td class="text-right text-gray-600" id="valor-receitas-financeiras">R$ 500,00</td>
                  <td class="text-right text-gray-600" id="perc-receitas-financeiras">0.5%</td>
                </tr>
                <tr>
                  <td class="text-indented">(-) Despesas Financeiras</td>
                  <td class="text-right text-gray-600" id="valor-despesas-financeiras">(R$ 2.000,00)</td>
                  <td class="text-right text-gray-600" id="perc-despesas-financeiras">2.0%</td>
                </tr>
                <tr class="bg-highlight">
                  <td class="font-bold">Lucro Antes do IR/CSLL</td>
                  <td class="text-right font-bold" id="valor-lucro-antes-ir">R$ 25.500,00</td>
                  <td class="text-right" id="perc-lucro-antes-ir">25.5%</td>
                </tr>
                <tr>
                  <td class="text-indented">(-) IR/CSLL (<span id="aliquota-ircsll">34</span>%)</td>
                  <td class="text-right text-gray-600" id="valor-ircsll">(R$ 8.670,00)</td>
                  <td class="text-right text-gray-600" id="perc-ircsll">8.7%</td>
                </tr>
                <tr class="bg-result">
                  <td class="font-bold">Lucro Líquido do Exercício</td>
                  <td class="text-right font-bold" id="valor-lucro-liquido">R$ 16.830,00</td>
                  <td class="text-right font-bold" id="perc-lucro-liquido">16.8%</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Gráficos -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
      <div class="card">
        <div class="card-header bg-purple-50">
          <h2 class="text-lg text-purple-700">Análise de Resultados</h2>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="barChart"></canvas>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header bg-amber-50">
          <h2 class="text-lg text-amber-700">Distribuição de Despesas</h2>
        </div>
        <div class="card-body">
          <div class="chart-container">
            <canvas id="pieChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Elementos de entrada
    const receitaBrutaInput = document.getElementById('receitaBruta');
    const deducoesInput = document.getElementById('deducoes');
    const cpvInput = document.getElementById('cpv');
    const despesasAdmInput = document.getElementById('despesasAdministrativas');
    const despesasVendasInput = document.getElementById('despesasVendas');
    const despesasFinanceirasInput = document.getElementById('despesasFinanceiras');
    const receitasFinanceirasInput = document.getElementById('receitasFinanceiras');
    const irCsllRateInput = document.getElementById('irCsllRate');
    
    // Função para formatar valores como moeda brasileira (BRL)
    function formatCurrency(value) {
      return new Intl.NumberFormat('pt-BR', {
        style: 'currency',
        currency: 'BRL'
      }).format(value);
    }
    
    // Função para formatar percentuais
    function formatPercent(value) {
      return value.toFixed(1) + '%';
    }
    
    // Referências para os gráficos
    let barChart;
    let pieChart;
    
    // Função para calcular e atualizar o DRE
    function calculateDRE() {
      // Obter valores dos inputs
      const receitaBruta = parseFloat(receitaBrutaInput.value) || 0;
      const deducoes = parseFloat(deducoesInput.value) || 0;
      const cpv = parseFloat(cpvInput.value) || 0;
      const despesasAdm = parseFloat(despesasAdmInput.value) || 0;
      const despesasVendas = parseFloat(despesasVendasInput.value) || 0;
      const despesasFinanceiras = parseFloat(despesasFinanceirasInput.value) || 0;
      const receitasFinanceiras = parseFloat(receitasFinanceirasInput.value) || 0;
      const irCsllRate = parseFloat(irCsllRateInput.value) || 0;
      
      // Cálculos do DRE
      const receitaLiquida = receitaBruta - deducoes;
      const lucroBruto = receitaLiquida - cpv;
      const despesasOperacionais = despesasAdm + despesasVendas;
      const resultadoOperacional = lucroBruto - despesasOperacionais;
      const resultadoFinanceiro = receitasFinanceiras - despesasFinanceiras;
      const lucroAntesIR = resultadoOperacional + resultadoFinanceiro;
      const irCsllValor = lucroAntesIR > 0 ? (lucroAntesIR * irCsllRate / 100) : 0;
      const lucroLiquido = lucroAntesIR - irCsllValor;
      
      // Atualizar a tabela com os valores calculados
      document.getElementById('valor-receita-bruta').textContent = formatCurrency(receitaBruta);
      document.getElementById('valor-deducoes').textContent = `(${formatCurrency(deducoes)})`;
      document.getElementById('perc-deducoes').textContent = formatPercent(deducoes / receitaBruta * 100);
      
      document.getElementById('valor-receita-liquida').textContent = formatCurrency(receitaLiquida);
      document.getElementById('perc-receita-liquida').textContent = formatPercent(receitaLiquida / receitaBruta * 100);
      
      document.getElementById('valor-cpv').textContent = `(${formatCurrency(cpv)})`;
      document.getElementById('perc-cpv').textContent = formatPercent(cpv / receitaBruta * 100);
      
      document.getElementById('valor-lucro-bruto').textContent = formatCurrency(lucroBruto);
      document.getElementById('perc-lucro-bruto').textContent = formatPercent(lucroBruto / receitaBruta * 100);
      
      document.getElementById('valor-desp-adm').textContent = `(${formatCurrency(despesasAdm)})`;
      document.getElementById('perc-desp-adm').textContent = formatPercent(despesasAdm / receitaBruta * 100);
      
      document.getElementById('valor-desp-vendas').textContent = `(${formatCurrency(despesasVendas)})`;
      document.getElementById('perc-desp-vendas').textContent = formatPercent(despesasVendas / receitaBruta * 100);
      
      document.getElementById('valor-resultado-operacional').textContent = formatCurrency(resultadoOperacional);
      document.getElementById('perc-resultado-operacional').textContent = formatPercent(resultadoOperacional / receitaBruta * 100);
      
      document.getElementById('valor-receitas-financeiras').textContent = formatCurrency(receitasFinanceiras);
      document.getElementById('perc-receitas-financeiras').textContent = formatPercent(receitasFinanceiras / receitaBruta * 100);
      
      document.getElementById('valor-despesas-financeiras').textContent = `(${formatCurrency(despesasFinanceiras)})`;
      document.getElementById('perc-despesas-financeiras').textContent = formatPercent(despesasFinanceiras / receitaBruta * 100);
      
      document.getElementById('valor-lucro-antes-ir').textContent = formatCurrency(lucroAntesIR);
      document.getElementById('perc-lucro-antes-ir').textContent = formatPercent(lucroAntesIR / receitaBruta * 100);
      
      document.getElementById('aliquota-ircsll').textContent = irCsllRate;
      document.getElementById('valor-ircsll').textContent = `(${formatCurrency(irCsllValor)})`;
      document.getElementById('perc-ircsll').textContent = formatPercent(irCsllValor / receitaBruta * 100);
      
      document.getElementById('valor-lucro-liquido').textContent = formatCurrency(lucroLiquido);
      document.getElementById('perc-lucro-liquido').textContent = formatPercent(lucroLiquido / receitaBruta * 100);
      
      // Atualizar os gráficos
      updateCharts(receitaBruta, receitaLiquida, lucroBruto, resultadoOperacional, lucroLiquido, 
                  cpv, despesasAdm, despesasVendas, despesasFinanceiras, irCsllValor);
    }
    
    // Função para inicializar e atualizar os gráficos
    function updateCharts(receitaBruta, receitaLiquida, lucroBruto, resultadoOperacional, lucroLiquido, 
                         cpv, despesasAdm, despesasVendas, despesasFinanceiras, irCsllValor) {
      
      // Dados para o gráfico de barras
      const barData = {
        labels: ['Receita Bruta', 'Receita Líquida', 'Lucro Bruto', 'Resultado Operacional', 'Lucro Líquido'],
        datasets: [{
          label: 'Valores (R$)',
          data: [receitaBruta, receitaLiquida, lucroBruto, resultadoOperacional, lucroLiquido],
          backgroundColor: ['#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#E91E63'],
          borderColor: ['#388E3C', '#1976D2', '#F57C00', '#7B1FA2', '#C2185B'],
          borderWidth: 1
        }]
      };
      
      // Dados para o gráfico de pizza
      const pieData = {
        labels: ['CPV', 'Desp. Adm.', 'Desp. Vendas', 'Desp. Financeiras', 'IR/CSLL'],
        datasets: [{
          data: [cpv, despesasAdm, despesasVendas, despesasFinanceiras, irCsllValor],
          backgroundColor: ['#F44336', '#673AB7', '#3F51B5', '#00BCD4', '#FFC107'],
          borderColor: ['#D32F2F', '#512DA8', '#303F9F', '#0097A7', '#FFA000'],
          borderWidth: 1
        }]
      };
      
      // Se os gráficos já existem, atualize-os
      if (barChart) {
        barChart.data = barData;
        barChart.update();
      } else {
        // Inicialize o gráfico de barras
        const barCtx = document.getElementById('barChart').getContext('2d');
        barChart = new Chart(barCtx, {
          type: 'bar',
          data: barData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function(value) {
                    return formatCurrency(value);
                  }
                }
              }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    return formatCurrency(context.raw);
                  }
                }
              }
            }
          }
        });
      }
      
      if (pieChart) {
        pieChart.data = pieData;
        pieChart.update();
      } else {
        // Inicialize o gráfico de pizza
        const pieCtx = document.getElementById('pieChart').getContext('2d');
        pieChart = new Chart(pieCtx, {
          type: 'pie',
          data: pieData,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = formatCurrency(context.raw);
                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                    const percentage = Math.round((context.raw / total) * 100);
                    return `${label}: ${value} (${percentage}%)`;
                  }
                }
              }
            }
          }
        });
      }
    }
    
    // Adicionar event listeners para os inputs
    receitaBrutaInput.addEventListener('input', calculateDRE);
    deducoesInput.addEventListener('input', calculateDRE);
    cpvInput.addEventListener('input', calculateDRE);
    despesasAdmInput.addEventListener('input', calculateDRE);
    despesasVendasInput.addEventListener('input', calculateDRE);
    despesasFinanceirasInput.addEventListener('input', calculateDRE);
    receitasFinanceirasInput.addEventListener('input', calculateDRE);
    irCsllRateInput.addEventListener('input', calculateDRE);
    
    // Calcular o DRE inicialmente
    document.addEventListener('DOMContentLoaded', calculateDRE);
  </script>
</body>
</html>